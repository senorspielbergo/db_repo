<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE xhtml>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:p ="http://primefaces.org/ui"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      >
    
    <h:body>
        <ui:composition template="templates/template.xhtml">
            
            <ui:define name="content">
                <h:panelGroup id="viewArea">
                    <h:form>
                    <p:panelGrid id="selection" columns="4" style="width:100%">
                        
                        <p:outputLabel value="WÃ¤hlen Sie einen Wahlkreis: "/>
                        
                        <p:selectOneMenu value="#{q7Bean.selectedDistrict}">
                            <f:converter binding ="#{districtConverter}" />
                            <f:selectItems value="#{q7Bean.districts}" var="dist" itemValue="#{dist}" itemLabel="#{dist.name}"/>
                            <p:ajax event="change" listener="#{q7Bean.onDistrictSelection}" 
                                    onstart="PF('statusDialog').show()" onsuccess="PF('statusDialog').hide()" 
                                    update="@form"/>
                        </p:selectOneMenu>
                        
                        
                        <p:outputLabel value="Wahljahr:"/>
                        
                        <p:selectOneRadio id="year" value="#{q7Bean.selectedYear}" >
                            <f:converter binding ="#{stringIntConverter}" />
                            <p:ajax event="change" listener="#{q7Bean.onYearSelection}" 
                                    onstart="PF('statusDialog').show()" 
                                    onsuccess="PF('statusDialog').hide()" 
                                    update="@form"/>
                            <f:selectItem itemLabel="2013" itemValue="2013" />
                            <f:selectItem itemLabel="2009" itemValue="2009" />
                        </p:selectOneRadio>
                        
                    </p:panelGrid>
                    <p:dialog widgetVar="statusDialog" modal="true" draggable="true" 
                              closable="false" 
                              width="300" 
                              resizable="false" 
                              showHeader="true"
                              header="Analysen werden geladen..."
                              >
                        <p:panelGrid columns="1" style="border:none">
                            <h:outputText value="Bitte haben Sie einen Moment Geduld. Die Analyse der Daten
                                                 wird live berechnet." 
                                          style="white-space: normal"/>
                            <p:graphicImage library="img" name="ajax-loader.gif" />
                        </p:panelGrid>
                    </p:dialog>
                        
                    <p:separator/>
                    <h:panelGrid columns="3" cellpadding="5" style="width:100%; " rendered="#{q7Bean.selectedDistrict!=null}">    
                        
                        <p:outputPanel>
                            <h:outputText value="Wahlkreis" style='width:100%; align-content: center'/>
                            <h:panelGrid columns="2" cellpadding="5">
                                
                                
                                <h:outputText value="Name:" />
                                <h:outputText value="#{q7Bean.selectedDistrict.name}" style="font-weight: bold"/>
                                
                                <h:outputText value="Id:" />
                                <h:outputText value="#{q7Bean.selectedDistrict.id}" style="font-weight: bold"/>

                                <h:outputText value="Bundesland:" />
                                <h:outputText value="#{q7Bean.selectedDistrict.bundesland}" style="font-weight: bold"/>
                                
                                <h:outputText value="Wahlberechtigte:" />
                                <h:outputText value="#{q7Bean.selectedDistrict.wahlberechtigte}" style="font-weight: bold"/>
                                
                                <h:outputText value="Wahlbeteiligung:" />
                                <h:outputText value="#{q7Bean.selectedDistrict.wahlbeteiligung} %" style="font-weight: bold"/>
                            </h:panelGrid>
                        </p:outputPanel>
                 
                        <p:outputPanel>
                            <h:outputText value="Direktkandidat" style='width:100%; align-content: center'/>
                            <h:panelGrid columns="2" cellpadding="5">
                                
                                
                                <h:outputText value="Name:" />
                                <h:outputText value="#{q7Bean.selectedDistrict.direktKandidat.title} #{q7Bean.selectedDistrict.direktKandidat.name}" style="font-weight: bold"/>
                                
                                <h:outputText value="Partei:" />
                                <h:outputText value="#{q7Bean.selectedDistrict.direktKandidat.party}" style="font-weight: bold"/>
                                
                                <h:outputText value="Stimmen:" />
                                <h:outputText value="#{q7Bean.selectedDistrict.direktKandidat.votes}" style="font-weight: bold"/>
                                
                            </h:panelGrid>
                        </p:outputPanel>
                        
                    
                    </h:panelGrid>
                    
                    <p:separator/>
                        <p:dataTable var="party" value="#{q7Bean.selectedDistrict.parties}"
                                     lazy="true"
                                     scrollable="true"
                                     scrollHeight="700"
                                     rendered="#{q7Bean.selectedDistrict!=null}">

                            <p:column headerText="Partei">
                                <h:outputText value="#{party.name}" />
                            </p:column>

                            <p:column headerText="Absolute Stimmen">
                                <h:outputText value="#{party.totalVotes}" />
                            </p:column>

                            <p:column headerText="Stimmenanteil in %">
                                <h:outputText value="#{party.percentage}" />
                            </p:column>
                        </p:dataTable>
                    <p:separator/>
                    
                    <p:dataTable var="history" value="#{q7Bean.selectedDistrict.histories}"
                                     lazy="true"
                                     scrollable="true"
                                     scrollHeight="700"
                                     rendered="#{q7Bean.selectedDistrict!=null}">
                            <f:facet name="header">
                                <p:outputLabel value="Wahlentwicklungen zu vorheriger Wahl" style='font-weight: bold'/>
                            </f:facet>
                                     
                            <p:column headerText="Partei">
                                <h:outputText value="#{history.party}" />
                            </p:column>

                            <p:column headerText="Erststimmendifferenz">
                                <h:outputText value="#{history.diffFirstVote}" />
                            </p:column>

                            <p:column headerText="in Pozent">
                                <h:outputText value="#{history.diffFirstVotePc}" />
                            </p:column>
                            
                            <p:column headerText="Zweitstimmendifferenz">
                                <h:outputText value="#{history.diffSecondVote}" />
                            </p:column>
                            
                            <p:column headerText="in Pozent">
                                <h:outputText value="#{history.diffSecondVotePc}" />
                            </p:column>
                            
                        </p:dataTable>
                    </h:form>
                </h:panelGroup>
                
            </ui:define>
        </ui:composition>
    </h:body>
</html>
